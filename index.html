<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Net Sheet Calculator - Empire Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: rgb(175, 35, 43);
            --secondary-color: #2c3e50;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --input-bg: #f8fafc;
            --input-border: #e2e8f0;
            --input-focus: #3b82f6;
            --spacing: 10px;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            min-height: 100vh;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .calculator-input {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .calculator-input:hover {
            box-shadow: var(--hover-shadow);
        }

        .form-section {
            margin-bottom: 15px;
            padding: 0;
        }

        .form-section h4 {
            color: var(--secondary-color);
            font-size: 1.1rem;
            margin: 0 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--input-border);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 4px;
            color: var(--secondary-color);
            font-weight: 500;
            font-size: 0.95rem;
        }

        input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--input-border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background-color: var(--input-bg);
            transition: var(--transition);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            box-sizing: border-box;
        }

        input:hover {
            border-color: #cbd5e1;
        }

        input:focus {
            outline: none;
            border-color: var(--input-focus);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        input::placeholder {
            color: #94a3b8;
        }

        .calculate-button {
            width: 100%;
            padding: 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(175, 35, 43, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calculate-button:hover {
            background: #8b1d23;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(175, 35, 43, 0.3);
        }

        .calculate-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(175, 35, 43, 0.2);
        }

        .save-print-button {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(175, 35, 43, 0.2);
        }

        .save-print-button:hover {
            background: #8b1d23;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(175, 35, 43, 0.3);
        }

        .results-panel {
            flex: 1;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-left: 2rem;
            max-width: 500px;
        }

        .results-section {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .results-section h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            font-size: 1rem;
            line-height: 1.4;
        }

        .result-value {
            font-weight: 600;
            color: var(--text-color);
        }

        .totals {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid var(--primary-color);
        }

        .grand-total {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .grand-total .result-value {
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        #save-print-btn {
            margin-top: 2rem;
            width: 100%;
        }

        .hidden {
            display: none;
        }

        .cd-section {
            margin-bottom: 25px;
            padding: 15px;
            background: var(--input-bg);
            border-radius: var(--border-radius);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .cd-section h3 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 1.5rem;
        }

        .cd-section h4 {
            color: var(--secondary-color);
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            border-bottom: 2px solid var(--input-border);
            padding-bottom: 8px;
        }

        .cd-table {
            width: 100%;
        }

        .cd-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--input-border);
            transition: var(--transition);
        }

        .cd-row:hover {
            background: rgba(0, 0, 0, 0.02);
            padding-left: 8px;
            padding-right: 8px;
        }

        .cd-total {
            font-weight: bold;
            border-top: 2px solid var(--input-border);
            margin-top: 15px;
            padding-top: 15px;
        }

        .cd-grand-total {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--primary-color);
            border-top: 2px solid var(--primary-color);
            margin-top: 15px;
            padding-top: 15px;
            background: #fff5f5;
            border-radius: var(--border-radius);
            padding: 20px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Modern scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--input-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Modal Styles */
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-backdrop.visible {
            opacity: 1;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 500px;
            z-index: 1001;
        }

        .modal h3 {
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: transform 0.3s ease;
        }

        .close-modal:hover {
            transform: rotate(90deg);
            color: var(--primary-color);
        }

        .form-section {
            margin-bottom: 2rem;
        }

        /* Additional styles for commission preview */
        .commission-preview {
            font-size: 0.9rem;
            color: var(--primary-color);
            margin-top: 0.5rem;
            font-style: italic;
        }

        .radio-group {
            margin: 10px 0;
            display: flex;
            gap: 20px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-label input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .action-btn.primary:hover {
            background: #8b1d23;
            transform: translateY(-2px);
        }

        .action-btn.secondary {
            background: white;
            color: var(--secondary-color);
            border: 2px solid var(--input-border);
        }

        .action-btn.secondary:hover {
            background: var(--input-bg);
            transform: translateY(-2px);
        }

        /* Modal Form Styles */
        .modal .form-group {
            margin-bottom: 1.5rem;
        }

        .modal .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-color);
            font-weight: 500;
        }

        .modal .form-group input[type="text"],
        .modal .form-group input[type="email"],
        .modal .form-group input[type="tel"] {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--input-bg);
        }

        .modal .form-group input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(175, 35, 43, 0.1);
            outline: none;
        }

        .modal .form-group input::placeholder {
            color: #999;
        }

        .modal .radio-group {
            display: flex;
            gap: 2rem;
            margin: 0.5rem 0;
        }

        .modal .radio-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .modal .radio-group input[type="radio"] {
            width: 1.2rem;
            height: 1.2rem;
            margin: 0;
        }

        .modal .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal .primary-button {
            padding: 0.8rem 1.5rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal .primary-button:hover {
            background: #8b1d23;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal .secondary-button {
            padding: 0.8rem 1.5rem;
            background: var(--input-bg);
            color: var(--text-color);
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal .secondary-button:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }

        /* File Upload Styling */
        .logo-preview {
            margin-top: 1rem;
            text-align: center;
        }

        .logo-preview img {
            max-width: 200px;
            max-height: 100px;
            object-fit: contain;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 0.5rem;
            background: white;
        }

        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            background: var(--input-bg);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: rgba(175, 35, 43, 0.05);
        }

        .file-upload-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .file-upload-text {
            text-align: center;
            color: var(--text-color);
        }

        .file-upload-text span {
            color: var(--primary-color);
            text-decoration: underline;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-buttons button {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .primary-button {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .primary-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .secondary-button {
            background: var(--input-bg);
            color: var(--text-color);
            border: 1px solid #ddd;
        }

        .secondary-button:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="calculator-grid">
        <!-- Left side: Input form -->
        <div class="calculator-input">
            <h2>Seller Net Sheet Calculator</h2>
            
            <div class="form-section">
                <h4>Property Information</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="sale-price">Sale Price</label>
                        <input type="text" 
                               id="sale-price" 
                               name="salePrice" 
                               class="currency-input"
                               placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label for="existing-mortgage">Existing Mortgage</label>
                        <input type="text" 
                               id="existing-mortgage" 
                               name="existingMortgage" 
                               class="currency-input"
                               placeholder="$0.00">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>Commission</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="commission">Real Estate Commission (%)</label>
                        <input type="number" 
                               id="commission" 
                               name="commission" 
                               placeholder="0.00" 
                               step="0.01" 
                               min="0"
                               value="6.00">
                        <div class="commission-preview"></div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h4>Additional Charges</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="property-taxes">Property Taxes</label>
                        <input type="text" 
                               id="property-taxes" 
                               name="propertyTaxes" 
                               class="currency-input"
                               placeholder="$0.00">
                    </div>
                    <div class="form-group">
                        <label for="other-fees">Other Fees</label>
                        <input type="text" 
                               id="other-fees" 
                               name="otherFees" 
                               class="currency-input"
                               placeholder="$0.00">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <button type="button" 
                        id="calculate-button" 
                        class="calculate-button" 
                        onclick="calculateSellerNet()">
                    Calculate Net Proceeds
                </button>
            </div>
        </div>

        <!-- Right side: Results -->
        <div id="results-panel" class="results-panel hidden">
            <h3>Calculation Results</h3>
            
            <div class="results-section">
                <h4>Transaction Details</h4>
                <div class="result-row">
                    <span>Sale Price:</span>
                    <span id="sale-price-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Existing Mortgage:</span>
                    <span id="mortgage-result" class="result-value">$0.00</span>
                </div>
            </div>

            <div class="results-section">
                <h4>Closing Costs</h4>
                <div class="result-row">
                    <span>Real Estate Commission:</span>
                    <span id="commission-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Settlement Fee:</span>
                    <span id="settlement-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Title Insurance:</span>
                    <span id="title-insurance-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Deed Preparation:</span>
                    <span id="deed-prep-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Release Tracking:</span>
                    <span id="release-tracking-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Wire Transfer:</span>
                    <span id="wire-transfer-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Property Taxes:</span>
                    <span id="property-taxes-result" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Other Fees:</span>
                    <span id="other-fees-result" class="result-value">$0.00</span>
                </div>
            </div>

            <div class="results-section totals">
                <div class="result-row">
                    <span>Total Closing Costs:</span>
                    <span id="total-closing-costs" class="result-value">$0.00</span>
                </div>
                <div class="result-row">
                    <span>Total Deductions:</span>
                    <span id="total-deductions" class="result-value">$0.00</span>
                </div>
                <div class="result-row grand-total">
                    <span>Estimated Net Proceeds:</span>
                    <span id="estimated-proceeds" class="result-value">$0.00</span>
                </div>
            </div>

            <button id="save-print-btn" class="calculate-button hidden">Save/Print Results</button>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal-backdrop" class="modal-backdrop">
        <div class="modal">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h3>Save/Print Results</h3>
            
            <form id="info-form">
                <div class="form-section">
                    <div class="form-group">
                        <label for="name">Name *</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                </div>

                <div class="form-section">
                    <label>Are you a real estate agent? *</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="isAgent" value="yes" required> Yes
                        </label>
                        <label>
                            <input type="radio" name="isAgent" value="no" required> No
                        </label>
                    </div>
                </div>

                <div id="agent-fields" class="form-section hidden">
                    <div class="form-group">
                        <label for="company">Company Name *</label>
                        <input type="text" id="company" name="company">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    
                    <div class="form-section">
                        <label>Would you like to add your logo? *</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="addLogo" value="yes"> Yes
                            </label>
                            <label>
                                <input type="radio" name="addLogo" value="no"> No
                            </label>
                        </div>
                    </div>

                    <div id="logo-field" class="form-group hidden">
                        <label>Company Logo</label>
                        <div class="file-upload" onclick="document.getElementById('logo').click()">
                            <div class="file-upload-icon">üìÅ</div>
                            <div class="file-upload-text">
                                Drag and drop your logo here or <span>browse files</span><br>
                                <small>Recommended size: 200x100px, Max size: 2MB</small>
                            </div>
                            <input type="file" id="logo" name="logo" accept="image/*" onchange="handleLogoUpload(this)">
                        </div>
                        <div class="logo-preview"></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button type="button" class="secondary-button" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="primary-button">Generate PDF</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Format currency for display
        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        // Format percentage for display
        function formatPercentage(value) {
            return value.toFixed(2) + '%';
        }

        // Parse currency string to number
        function parseCurrency(value) {
            if (typeof value === 'string') {
                return parseFloat(value.replace(/[^0-9.-]+/g, '')) || 0;
            }
            return value || 0;
        }

        // Calculate commission amount
        function calculateCommissionAmount() {
            const salePrice = parseCurrency(document.getElementById('sale-price').value);
            const commissionRate = parseFloat(document.getElementById('commission').value) / 100;
            return salePrice * commissionRate;
        }

        // Update commission preview
        function updateCommissionPreview() {
            const commissionAmount = calculateCommissionAmount();
            const preview = document.querySelector('.commission-preview');
            if (preview) {
                preview.textContent = `Commission Amount: ${formatCurrency(commissionAmount)}`;
            }
        }

        // Format all currency displays
        function updateCurrencyDisplays() {
            const results = document.querySelectorAll('.result-value');
            results.forEach(result => {
                const value = parseCurrency(result.textContent);
                result.textContent = formatCurrency(value);
            });
        }

        // Initialize input handling
        document.addEventListener('DOMContentLoaded', function() {
            // Set default commission value
            const commissionInput = document.getElementById('commission');
            if (commissionInput) {
                commissionInput.value = '6.00';
                commissionInput.addEventListener('input', updateCommissionPreview);
                commissionInput.addEventListener('change', function() {
                    let value = parseFloat(this.value);
                    if (isNaN(value)) value = 0;
                    if (value < 0) value = 0;
                    this.value = value.toFixed(2);
                    updateCommissionPreview();
                });
            }

            // Handle sale price changes
            const salePriceInput = document.getElementById('sale-price');
            if (salePriceInput) {
                salePriceInput.addEventListener('input', updateCommissionPreview);
                salePriceInput.addEventListener('change', function() {
                    let value = parseCurrency(this.value);
                    if (isNaN(value)) value = 0;
                    if (value < 0) value = 0;
                    updateCommissionPreview();
                });
            }

            // Initialize commission preview
            updateCommissionPreview();
        });

        // Calculate seller net proceeds
        function calculateSellerNet() {
            const salePrice = parseCurrency(document.getElementById('sale-price').value);
            const existingMortgage = parseCurrency(document.getElementById('existing-mortgage').value);
            const commission = calculateCommissionAmount(); // Use calculated commission amount
            const propertyTaxes = parseCurrency(document.getElementById('property-taxes').value);
            const otherFees = parseCurrency(document.getElementById('other-fees').value);

            // Fixed fees
            const settlementFee = 350;
            const titleInsurance = calculateTitleInsurance(salePrice);
            const deedPreparation = 150;
            const releaseTracking = 75;
            const wireTransfer = 30;

            // Calculate totals
            const totalClosingCosts = commission + settlementFee + titleInsurance + 
                                    deedPreparation + releaseTracking + wireTransfer + 
                                    propertyTaxes + otherFees;

            const totalDeductions = existingMortgage + totalClosingCosts;
            const estimatedProceeds = salePrice - totalDeductions;

            // Update results
            document.getElementById('sale-price-result').textContent = formatCurrency(salePrice);
            document.getElementById('mortgage-result').textContent = formatCurrency(existingMortgage);
            document.getElementById('commission-result').textContent = formatCurrency(commission);
            document.getElementById('settlement-result').textContent = formatCurrency(settlementFee);
            document.getElementById('title-insurance-result').textContent = formatCurrency(titleInsurance);
            document.getElementById('deed-prep-result').textContent = formatCurrency(deedPreparation);
            document.getElementById('release-tracking-result').textContent = formatCurrency(releaseTracking);
            document.getElementById('wire-transfer-result').textContent = formatCurrency(wireTransfer);
            document.getElementById('property-taxes-result').textContent = formatCurrency(propertyTaxes);
            document.getElementById('other-fees-result').textContent = formatCurrency(otherFees);
            document.getElementById('total-closing-costs').textContent = formatCurrency(totalClosingCosts);
            document.getElementById('total-deductions').textContent = formatCurrency(totalDeductions);
            document.getElementById('estimated-proceeds').textContent = formatCurrency(estimatedProceeds);

            // Show results panel and save/print button
            document.getElementById('results-panel').classList.remove('hidden');
            document.getElementById('save-print-btn').classList.remove('hidden');
        }

        // Calculate title insurance based on sale price
        function calculateTitleInsurance(salePrice) {
            if (salePrice <= 50000) {
                return salePrice * 0.004;
            } else if (salePrice <= 100000) {
                return 200 + (salePrice - 50000) * 0.0035;
            } else if (salePrice <= 500000) {
                return 375 + (salePrice - 100000) * 0.003;
            } else if (salePrice <= 1000000) {
                return 1575 + (salePrice - 500000) * 0.002;
            } else if (salePrice <= 2000000) {
                return 2575 + (salePrice - 1000000) * 0.00175;
            } else {
                return 4325 + (salePrice - 2000000) * 0.0015;
            }
        }

        // Modal handling
        function showModal() {
            const backdrop = document.getElementById('modal-backdrop');
            backdrop.style.display = 'block';
            setTimeout(() => {
                backdrop.classList.add('visible');
            }, 10);
        }

        function closeModal() {
            const backdrop = document.getElementById('modal-backdrop');
            backdrop.classList.remove('visible');
            setTimeout(() => {
                backdrop.style.display = 'none';
            }, 300);
        }

        // Initialize input handling
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing initialization code ...

            // Save/Print button handler
            document.getElementById('save-print-btn').addEventListener('click', showModal);

            // Agent radio button handler
            document.querySelectorAll('input[name="isAgent"]').forEach(radio => {
                radio.addEventListener('change', function(e) {
                    const agentFields = document.getElementById('agent-fields');
                    agentFields.classList.toggle('hidden', e.target.value === 'no');
                    
                    // Reset required attributes
                    const companyInput = document.getElementById('company');
                    const phoneInput = document.getElementById('phone');
                    const logoRadios = document.querySelectorAll('input[name="addLogo"]');
                    
                    if (e.target.value === 'yes') {
                        companyInput.required = true;
                        phoneInput.required = true;
                        logoRadios.forEach(radio => radio.required = true);
                    } else {
                        companyInput.required = false;
                        phoneInput.required = false;
                        logoRadios.forEach(radio => radio.required = false);
                    }
                });
            });

            // Logo radio button handler
            document.querySelectorAll('input[name="addLogo"]').forEach(radio => {
                radio.addEventListener('change', function(e) {
                    const logoField = document.getElementById('logo-field');
                    logoField.classList.toggle('hidden', e.target.value === 'no');
                    
                    // Update logo input required attribute
                    const logoInput = document.getElementById('logo');
                    logoInput.required = e.target.value === 'yes';
                });
            });

            // Form submission handler
            document.getElementById('info-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                await generatePDF();
            });
        });

        // Handle logo upload
        function handleLogoUpload(input) {
            const preview = document.querySelector('.logo-preview');
            const file = input.files[0];
            
            if (file) {
                // Check file size (2MB limit)
                if (file.size > 2 * 1024 * 1024) {
                    alert('File size must be less than 2MB');
                    input.value = '';
                    return;
                }

                // Check file type
                if (!file.type.startsWith('image/')) {
                    alert('Please upload an image file');
                    input.value = '';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Logo Preview">`;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        }

        // Generate PDF
        async function generatePDF() {
            const { jsPDF } = window.jspdf;

            try {
                const pdf = new jsPDF();
                const pageWidth = pdf.internal.pageSize.width;
                const pageHeight = pdf.internal.pageSize.height;
                const margin = 20;

                // Helper functions for styling
                function drawSection(y, height) {
                    pdf.setDrawColor(200, 200, 200);
                    pdf.setFillColor(250, 250, 250);
                    pdf.roundedRect(margin, y, pageWidth - (margin * 2), height, 2, 2, 'FD');
                }

                function addSectionHeader(text, y) {
                    pdf.setFillColor(175, 35, 43);
                    pdf.rect(margin, y, pageWidth - (margin * 2), 8, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(text, margin + 5, y + 6);
                }

                function addLineItem(label, value, x, y, bold = false) {
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, bold ? 'bold' : 'normal');
                    pdf.text(label, x, y);
                    pdf.text(value, x + 100, y, { align: 'right' });
                    return y + 6;
                }

                // HEADER SECTION
try {
    console.log('Adding Empire logo...');
    pdf.addImage(empireLogo_base64, 'PNG', (pageWidth - 120) / 2, margin, 120, 60);
} catch (logoError) {
    console.warn('Could not load Empire logo:', logoError);
};
                    
                    const logoWidth = 120;
                    const logoHeight = (empireLogo.height * logoWidth) / empireLogo.width;
                    const logoX = (pageWidth - logoWidth) / 2;
                    pdf.addImage(empireLogo, 'PNG', logoX, margin, logoWidth, logoHeight);
                } catch (logoError) {
                    console.warn('Could not load Empire logo:', logoError);
                }

                // Title
                pdf.setFontSize(20);
                pdf.setTextColor(175, 35, 43);
                pdf.setFont(undefined, 'bold');
                pdf.text('SELLER NET SHEET', pageWidth / 2, margin + 35, { align: 'center' });
                
                let currentY = margin + 50;

                // BODY SECTION
                // Transaction Information
                drawSection(currentY, 40);
                addSectionHeader('TRANSACTION INFORMATION', currentY);
                currentY += 15;

                const salePrice = document.getElementById('sale-price-result').textContent;
                const mortgage = document.getElementById('mortgage-result').textContent;
                
                currentY = addLineItem('Sale Price', salePrice, margin + 5, currentY, true);
                currentY = addLineItem('Existing Mortgage', mortgage, margin + 5, currentY);
                
                currentY += 20;

                // Closing Costs Section
                drawSection(currentY, 85);
                addSectionHeader('CLOSING COSTS', currentY);
                currentY += 15;

                const closingCosts = [
                    ['Real Estate Commission', document.getElementById('commission-result').textContent],
                    ['Settlement Fee', document.getElementById('settlement-result').textContent],
                    ['Title Insurance', document.getElementById('title-insurance-result').textContent],
                    ['Deed Preparation', document.getElementById('deed-prep-result').textContent],
                    ['Release Tracking', document.getElementById('release-tracking-result').textContent],
                    ['Wire Transfer', document.getElementById('wire-transfer-result').textContent],
                    ['Property Taxes', document.getElementById('property-taxes-result').textContent],
                    ['Other Fees', document.getElementById('other-fees-result').textContent]
                ];

                closingCosts.forEach(([label, value]) => {
                    currentY = addLineItem(label, value, margin + 5, currentY);
                });

                currentY += 20;

                // Summary Section
                drawSection(currentY, 60);
                addSectionHeader('SUMMARY', currentY);
                currentY += 15;

                const totalClosingCosts = document.getElementById('total-closing-costs').textContent;
                const totalDeductions = document.getElementById('total-deductions').textContent;
                const estimatedProceeds = document.getElementById('estimated-proceeds').textContent;

                currentY = addLineItem('Total Closing Costs', totalClosingCosts, margin + 5, currentY);
                currentY = addLineItem('Total Deductions', totalDeductions, margin + 5, currentY);
                currentY += 8;
                currentY = addLineItem('ESTIMATED NET PROCEEDS', estimatedProceeds, margin + 5, currentY, true);

                // FOOTER SECTION
                const footerY = pageHeight - margin - 50;
                drawSection(footerY, 45);

                // Add Missy's section in bottom right
try {
    console.log('Adding Missy photo...');
    const missyWidth = 30;
    const missyHeight = 30;
    const missyX = pageWidth - margin - missyWidth - 5;
    const missyY = footerY + 5;

    // Add image with white background
    pdf.setFillColor(255, 255, 255);
    pdf.rect(missyX - 2, missyY - 2, missyWidth + 4, missyHeight + 4, 'F');
    pdf.addImage(missyPhoto_base64, 'JPEG', missyX, missyY, missyWidth, missyHeight);
                    });

                    // Position Missy's section
                    const missyWidth = 30; // Even smaller for better layout
                    const missyHeight = (missyImage.height * missyWidth) / missyImage.width;
                    const missyX = pageWidth - margin - missyWidth - 5;
                    const missyY = footerY + 5;

                    // Add image with white background
                    pdf.setFillColor(255, 255, 255);
                    pdf.rect(missyX - 2, missyY - 2, missyWidth + 4, missyHeight + 4, 'F');
                    pdf.addImage(missyImage, 'JPG', missyX, missyY, missyWidth, missyHeight);

                    // Add contact info with styling - centered under image
                    pdf.setFontSize(8);
                    let infoY = missyY + missyHeight + 4; // Start below image
                    
                    // Calculate center point under image for text alignment
                    const centerX = missyX + (missyWidth / 2);
                    
                    // Name in red
                    pdf.setTextColor(175, 35, 43);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Missy Horner', centerX, infoY, { align: 'center' });
                    infoY += 4;

                    // Other info in dark gray
                    pdf.setTextColor(44, 62, 80);
                    pdf.setFont(undefined, 'normal');
                    ['Empire Title Services Inc.', '(765) 935-9966', 'missy@empiretitleservice.com']
                        .forEach(line => {
                            pdf.text(line, centerX, infoY, { align: 'center' });
                            infoY += 4;
                        });

                } catch (missyError) {
                    console.warn('Could not load Missy image:', missyError);
                }

                // Add date and disclaimer
                pdf.setFontSize(8);
                pdf.setTextColor(128, 128, 128);
                pdf.text('Generated: ' + new Date().toLocaleDateString(), margin + 5, footerY + 10);
                pdf.text('This is an estimate only. Actual proceeds may vary.', margin + 5, footerY + 15);

                // Save and open PDF
                const pdfBlob = pdf.output('blob');
                const blobUrl = URL.createObjectURL(pdfBlob);
                window.open(blobUrl, '_blank');
                
                // Clean up
                closeModal();

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Could not generate PDF. Please try again.');
            }
        }
    </script>
</body>
</html>
